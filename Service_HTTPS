{
    "$schema": "https://raw.githubusercontent.com/F5Networks/f5-appsvcs-extension/master/schema/latest/as3-schema-3.9.0-3.json",
    "class": "AS3",
    "action": "deploy",
    "persist": true,
    "declaration": {
        "class": "ADC",
        "schemaVersion": "3.12.0",
        "id": "urn:uuid:33045210-3ab8-4636-9b2a-c98d22ab915d",
        "label": "Sample 1",
        "remark": "Simple HTTP Service with Round-Robin Load Balancing",
        "{{service_name}}": {
            "class": "Tenant",
            "{{app_name}}": {
                "class": "Application",
                "template": "generic",
                "{{app_name}}_vs": {
                    "class": "{{ class_template }}",
                    "label": "my application {{app_name}}",
                    "virtualAddresses": [
                        "{{vs_ip}}"
                    ],
                    {% if class_template == "Service_HTTPS" %}
                    "virtualPort": {{vs_port | default(443)}},
                    {% else %}
                    "virtualPort": {{vs_port | default(80)}},
                    {% endif %}
                    {% if class_template == "Service_HTTPS" %}
                    "serverTLS": "{{ app_name}}_clientssl_profile",
                    {% if SSL_OFFLOAD == "False" %}
                    "clientTLS": "{{ app_name }}_serverssl_profile",
                    {% endif %}
                    {% endif %}
                    "persistenceMethods": [],
                    "pool": "{{app_name}}_pool"
                },
                "{{app_name}}_pool": {
                    "class": "Pool",
                    "monitors": [
                        "http"
                    ],
                    "members": [
                        {% set comma = joiner(",") %}
                        {% for member in groups['pool']%}
                        {{comma()}}
                        {
                            "serverAddresses":["{{hostvars[member]['address']}}"],
                            "servicePort":{{hostvars[member]['port']}}
                        }
                        {% endfor %}
                    ]
                },
                {% if class_template == "Service_HTTPS" %}
                "{{ app_name }}_clientssl_profile": {
                    "class": "TLS_Server",
                        "certificates": [
                            {
                                "certificate": "client_cert",
                                    "matchToSNI": ""
                            }
                        ]
                },
                "client_cert": {
                    "class": "Certificate",
                    "certificate": "-----BEGIN CERTIFICATE-----MIIFzDCCA7SgAwIBAgIUfOB6nia8/T6NDtV/bHpqK3VDtPIwDQYJKoZIhvcNAQELBQAwgbMxCzAJBgNVBAYTAlVLMRAwDgYDVQQIDAdHbGFzZ293MRowGAYDVQQKDBFpbnQuZnVsbHByb3h5LmNvbTENMAsGA1UECwwEVGVjaDEoMCYGA1UEAwwfc3ViY2Etc2FuZGJveC5pbnQuZnVsbHByb3h5LmNvbTErMCkGCSqGSIb3DQEJARYcbWljaGFlbC5mb3JyZXRAZnVsbHByb3h5LmNvbTEQMA4GA1UEBwwHR2xhc2dvdzAeFw0yMDAxMDkxNjI1NTZaFw0zMDAxMDYxNjI1NTZaMCMxITAfBgNVBAMMGGFwcF8xMC5pbnQuZnVsbHByb3h5LmNvbTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBANFre2gzrmjSkeVL7Kv1eqJYBSudk+lz4KupxmoQ0iIShPh/13qo9U1kYBN7Ga2StNXvGt+agcPCy3c0cKcYo31A6I1uaI7w+ryfqCk/2WF/aLBi0vDYMge/HNsgTieVRPYpPuvk1PbFO2iQ7BJXDkZ/nyZlpJln5qiXqRst5liEoEeB4krW3Z9+xsDV7M9DYp63nY/J2yow+9qcTm9gwab1nZzOstqq6F1C7Ot1Glw5X/ygwIlQlqNljkCQ2gLZIcTq5pL4VPy8wkSW0OIdugc02sJYQBbM2YsvLJwLhrh2MvdrgsQSbjrSutfIz9GdNhlpMDff28f/aOIMSciTjI+rkiZfYzkbQer06xOI5rv24cC2JkOxRSz90wPTF6BMx93Lc3tLTC5EDBqZG/WRQI6D3SVPHWHJCDlhvF2ONBWcZQFJXG8BKttfnBozMhTH+UXWHNDuyvu185AT5Wq/If5vtN8g5OdsHIBIGLfPOr/PTS6qIPuJ8E2ZIY0OHEU6vVuBE8QV8uTIiHr24kfLv0YxoZg8bo82UiIc70zdOWlmrWfMyFFrCWaOT+I6NrBxiCrqGTSH0N48kImwssfgkjKPWiiS7YhIzE5wiL38QiUxjzxZsMrnhKAZL9dsjWk21d3tDhVD3t+dGYARraTAVHLWZHOkvzHhO9xB/C9R2wa1AgMBAAGjZzBlMCMGA1UdEQQcMBqCGGFwcF8xMC5pbnQuZnVsbHByb3h5LmNvbTAdBgNVHQ4EFgQUfPe8urzqeff7nfVy8eXSsZVC2BYwHwYDVR0jBBgwFoAUphMA+kNnf3HOLqGVrSlv4litioowDQYJKoZIhvcNAQELBQADggIBALPCnERShM5Wt0A/sL4wNDjjNotLCLB7xrNF8PX1FBI2gbO1GsKPOjeGEgu0HtbAAGh1ZGqRR15U8YiSuRUh0sMkwEsTfXqNRsJuKR/PHZ5W7YF+QkL9yR0nb0Qa0K2CF3wITITjiog5ObXXyAgcEMWPrjZFoJEFwyg723JYptVA9NqbgBNkjmWwxFpz1vrXF0LA+aRTbqzE5bwKyoeniEllZJW1hmtw9+DQNomzM3KBvTYVUmS1YWn3vDS6qVlDp7ET5d+9ehecuGriUugEcH4aPGmoLFCAcO5OMQzojzUKBxF8sYV5za9GBD2NpKDsU59NvEcMl15Ey9owsEkYdquCis+mZjiYZUOqKbQLnqWZIjye/KUruC7yMc8ckcS/wIKweZnEAo8HhVWGDLfM/oTNE+uMbibPyZRlUC04dKXTRobIDGJdEjjqzPaK1eNvNpiObr8xsEJ8wRG9MWuIQhAHr2AWeySnY+w36e6wN+wIp0EtOTgy6y5uyIRzHVr94ryxKCpfA8CdfNEY6z138TNlc0RgsFZFbpedtjW12DC/U8MjgRJStCsNOKmxRK7Xp/a9JE0Ec7ju70QN+cZnOZnLTXf2caAF0cVdNmEsWRGUHgbNOUqKLRV8d8esJt4AvDDTWsMXat7lyED6eCKOZALAXQZKtgbJG6CYO46yIdz2-----END CERTIFICATE-----",
                    "privateKey": "-----BEGIN RSA PRIVATE KEY-----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-----END RSA PRIVATE KEY-----"
                },
                {% if SSL_OFFLOAD == "False" %}
                "{{ app_name }}_serverssl_profile": {
                    "class": "TLS_Client",
                    "clientCertificate":"server_cert"
                },
                "server_cert": {
                    "class": "Certificate",
                    "certificate": {"bigip": "/Common/default.crt"}
                },
                {% endif %}
                {% endif %}
            }
        }
    }
}
