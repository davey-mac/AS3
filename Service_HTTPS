{
        {% set pool_name = "_".join([app_name,'pool']) %}
        {% set tcp_profile = "_".join([app_name,'clienttcp_profile']) %}
        {% set http_profile = "_".join([app_name,'http_pofile']) %}
        {% set http_monitor = "_".join([app_name,'http_monitor']) %}
        {% set clientssl_profile = "_".join([app_name,'clientssl_profile']) %}
        {% set serverssl_profile = "_".join([app_name,'clientssl_profile']) %}

        "class": "AS3",
        "action": "{{ action_var | default('dry-run') }}",
        "persist": {{ persist_var | default(true) }},
        "syncToGroup": "{{ syncToGroup_var | default('') }}",
        "declaration": {
                "class": "ADC",
                "schemaVersion": "3.15.0",
                "id": "12345",
                "label": "{{ app_name }} deployment",
                "remark": "{{ app_name }}",
                "updateMode": "selective",
                "{{ tenant_name }}": {
                        "class": "Tenant",
                        "defaultRouteDomain": {{ defaultRouteDomain_var | default(0) }},
                        "{{ app_name }}": {
                                "class": "Application",
                                "template": "generic",
                                "{{ app_name }}": {
                                        "class": "{{ class }}",
                                        "virtualAddresses":
                                        [
                                                "{{ dest_ip }}"
                                        ],
                                        "virtualPort": {{ virtualPort_var | default(443) }},
                                        "pool": "{{ pool_name }}",
                                        {% if class == "Service_HTTPS" %}
                                        "serverTLS": "{{ clientssl_profile }}",
                                        {% if SSL_OFFLOAD != "True" %}
                                        "clientTLS": "{{ serverssl_profile }}",
                                        {% endif %}
                                        {% endif %}
                                        "snat": "{{ snat_var | default('auto') }}",
                                        "profileTCP": {"use": "{{ tcp_profile }}"},
                                        "profileHTTP": {"use": "{{ http_profile }}"}
                                },
                                "{{ clientssl_profile }}": {
                                        "class": "TLS_Server",
                                        "certificates": [
                                                {
                                                        "certificate": "webcert"
                                                }
                                        ]
                                },
                                {% if SSL_OFFLOAD != "True" %}
                                "{{ serverssl_profile }}": {
                                        "class": "TLS_Client",
                                        "clientCertificate":"webcert"
                                },
                                {% endif %}
                                "webcert": {
                                        "class": "Certificate",
                                        "certificate": {"bigip": "/Common/default.crt"},
                                        "privateKey": {"bigip": "/Common/default.key"}
                                },
                                "{{ pool_name }}": {
                                        "class": "Pool",
                                        "monitors": [
                                                {
                                                        "use": "{{ http_monitor }}"
                                                }
                                        ],
                                        "members": [
                                                {
                                                        {% if SSL_OFFLOAD == "True" %}
                                                        "servicePort": {{ servicePort_var | default(80) }},
                                                        {% else %}
                                                        "servicePort": {{ servicePort_var | default(443) }},
                                                        {% endif %}
                                                        "serverAddresses": [
                                                                {% set comma = joiner(",") %}
                                                                {% for member in pool_members %}
                                                                {{comma()}} "{{ hostvars[member]['private_ip'] }}"
                                                                {% endfor %}
                                                        ]
                                                }
                                        ]
                                },
                                "{{ http_monitor }}": {
                                        "class": "Monitor",
                                        "monitorType": "{{ monitorType_var | default('http') }}"
                                },
                                "{{ tcp_profile }}": {
                                        "class": "TCP_Profile",
                                        "label": "{{ tcp_profile }}"
                                },
                                "{{ http_profile }}": {
                                        "class": "HTTP_Profile",
                                        "label": "{{ http_profile }}"
                                }
                        }
                }
        }
}
