{
        {% set pool_name = "_".join([app_name,'pool']) %}
        {% set tcp_profile = "_".join([app_name,'clienttcp_profile']) %}
        {% set http_profile = "_".join([app_name,'http_pofile']) %}
        {% set http_monitor = "_".join([app_name,'http_monitor']) %}
        {% set clientssl_profile = "_".join([app_name,'clientssl_profile']) %}
        {% set serverssl_profile = "_".join([app_name,'clientssl_profile']) %}

        "class": "AS3",
        "action": "deploy",
        "persist": true,
        "declaration": {
                "class": "ADC",
                "schemaVersion": "3.15.0",
                "id": "12345",
                "label": "{{ app_name }}",
                "remark": "{{ app_name }}",
                "{{ tenant_name }}": {
                        "class": "Tenant",
                        "template": "generic",
                        "{{ app_name }}": {
                                "class": "Service_HTTPS",
                                "virtualAddresses":
                                [
                                        "{{ dest_ip }}"
                                ],
                                "virtualPort": 443,
                                "pool": "{{ pool_name }}",
                                "serverTLS": "{{ clientssl_profile }}",
                                {% if SSL_OFFLOAD != "True" %}
                                "clientTLS": "{{ serverssl_profile }}",
                                {% endif %}
                                "snat": "auto",
                                "profileTCP": {"use": "{{ tcp_profile }}"}
                        },
                        "{{ clientssl_profile }}": {
                                "class": "TLS_Server",
                                "certificates": [
                                        {
                                                "certificate": "webcert"
                                        }
                                ]
                        },
                        {% if SSL_OFFLOAD != "True" %}
                        "{{ serverssl_profile }}": {
                                "class": "TLS_Client",
                                "clientCertificate":"webcert"
                        },
                        {% endif %}
                        "webcert": {
                                "class": "Certificate",
                                "certificate": {"bigip": "/Common/default.crt"},
                                "privateKey": {"bigip": "/Common/default.key"}.
                        },
                        "{{ pool_name }}": {
                                "class": "Pool",
                                "monitors": [
                                        {
                                                "use": "{{ http_monitor }}"
                                        }
                                ],
                                "members": [
                                        {
                                                {% if SSL_OFFLOAD == "True" %}
                                                "servicePort": 80,
                                                {% else %}
                                                "servicePort": 443,
                                                {% endif %}
                                                "serverAddresses": [
                                                        {% set comma = joiner(",") %}
                                                        {% for member in pool_members %}
                                                        {{comma()}} "{{ hostvars[member]['private_ip'] }}"
                                                        {% endfor %}
                                                ]
                                        }
                                ]
                        },
                        "{{ http_mon }}": {
                                "class": "Monitor",
                                "monitorType": "http"
                        },
                        "{{ tcp_profile }}": {
                                "class": "TCP_Profile",
                                "label": "{{ tcp_profile }}"
                        }
                }
        }
}

